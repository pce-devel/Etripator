/*
¬°¤*,¸¸,*¤°¬¯¬°¤*,¸_¸,*¤°¬°¤*,¸,*¤°¬¯¬°¤*,¸_¸,*¤°¬°¤*,¸,*¤°¬¯¬°¤*,¸_¸,*¤°¬°¤*,¸
¸,*¤°¬¯¬°¤*,¸_¸,*¤°¬°¤*,¸,*¤°¬¯¬°¤*,¸_¸,*¤°¬°¤*,¸,*¤°¬¯¬°¤*,¸_¸,*¤°¬°¤*,¸,*¤°¬¯

  __/¯\____ ___/\__   _/\__   _/\_   _/\__   _/\___ ___/\__   __/\_   _/\__   
  \_  ____/_> ____ \_/  _  \_ \  <  /_    \_/     _>> ____ \_ >    \_/  _  \_ 
  _> ___/ ¯>__> <<__// __  _/ |>  ></ _/>  </  ¯  \\__> <<__//  /\  // __  _/ 
 _>  \7   <__/:. \__/:. \>  \_/   L/  _____/.  7> .\_/:. \__/  <_/ </:. \>  \_ 
|:::::::::::::::::::::::/:::::::::::::>::::::::/::::::::::::::::::::::::/:::::|
|¯¯\::::/\:/¯\::::/¯¯¯¯<::::/\::/¯¯\:/¯¯¯¯¯¯\::\::/¯¯\::::/¯¯\::::/¯¯¯¯<::::/¯|
|__ |¯¯|  T _ |¯¯¯| ___ |¯¯|  |¯| _ T ______ |¯¯¯¯| _ |¯¯¯| _ |¯¯¯| ___ |¯¯| _|
   \|__|/\|/ \|___|/   \|__|/\|_|/ \|/      \|    |/ \|___|/ \|___|/dNo\|__|/  

¬°¤*,¸¸,*¤°¬¯¬°¤*,¸_¸,*¤°¬°¤*,¸,*¤°¬¯¬°¤*,¸_¸,*¤°¬°¤*,¸,*¤°¬¯¬°¤*,¸_¸,*¤°¬°¤*,¸
¸,*¤°¬¯¬°¤*,¸_¸,*¤°¬°¤*,¸,*¤°¬¯¬°¤*,¸_¸,*¤°¬°¤*,¸,*¤°¬¯¬°¤*,¸_¸,*¤°¬°¤*,¸,*¤°¬¯

  This file is part of Etripator,
  copyright (c) 2009--2023 Vincent Cruz.
 
  Etripator is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.
 
  Etripator is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.
 
  You should have received a copy of the GNU General Public License
  along with Etripator.  If not, see <http://www.gnu.org/licenses/>.

¬°¤*,¸¸,*¤°¬¯¬°¤*,¸_¸,*¤°¬°¤*,¸,*¤°¬¯¬°¤*,¸_¸,*¤°¬°¤*,¸,*¤°¬¯¬°¤*,¸_¸,*¤°¬°¤*,¸
¸,*¤°¬¯¬°¤*,¸_¸,*¤°¬°¤*,¸,*¤°¬¯¬°¤*,¸_¸,*¤°¬°¤*,¸,*¤°¬¯¬°¤*,¸_¸,*¤°¬°¤*,¸,*¤°¬¯
*/
#ifndef ETRIPATOR_MEMORY_MAP_H
#define ETRIPATOR_MEMORY_MAP_H

#include "memory.h"

/// PC Engine memory blocks.
enum {
    PCE_MEMORY_NONE = -1,
    PCE_MEMORY_ROM = 0,
    PCE_MEMORY_BASE_RAM,
    PCE_MEMORY_CD_RAM,
    PCE_MEMORY_SYSCARD_RAM,
    PCE_MEMORY_COUNT
};

#define PCE_PAGE_COUNT 0x100U

#define PCE_MPR_COUNT 8U

#define PCE_BANK_SIZE 8192U

/// PC Engine memory page description.
typedef struct {
    int id;         // name the PCE_MEMORY_* enum ?
    size_t bank;
} Page;

/// PC Engine memory map.
typedef struct {
    Memory memory[PCE_MEMORY_COUNT];
    Page page[PCE_PAGE_COUNT];
    uint8_t mpr[PCE_MPR_COUNT];
} MemoryMap;

/// Initializes memory map.
/// \param [in out] map Memory map.
/// \return true 
/// \return false
bool memory_map_init(MemoryMap *map);

/// Releases resources used by the memory map.
/// \param [in out] map Memory map.
void memory_map_destroy(MemoryMap *map);

/// Get the memory page associated to a logical address.
/// \param [in] map Memory map.
/// \param [in] logical Logical address.
/// \return Memory page.
uint8_t memory_map_page(MemoryMap* map, uint16_t logical);

/// Reads a single byte from memory.
/// \param [in] map     Memory map.
/// \param [in] logical Logical address.
/// \return The value stored at the specified logical address.
uint8_t memory_map_read(MemoryMap *map, size_t logical);

/// Update the whole mprs list
/// \param [in out] map Memory map.
/// \param [in]     mpr Memory page registers.
void memory_map_mpr(MemoryMap *map, const uint8_t mpr[PCE_MPR_COUNT]);

#endif // ETRIPATOR_MEMORY_MAP_H
